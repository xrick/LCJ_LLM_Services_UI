<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 聊天助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .messages-container {
            height: calc(100vh - 180px);
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        .message {
            max-width: 80%;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #1d4ed8;
            color: white;
            border-radius: 1rem 1rem 0 1rem;
        }
        .assistant-message {
            background-color: #f3f4f6;
            color: #1f2937;
            border-radius: 1rem 1rem 1rem 0;
        }
    </style>
</head>
<body class="bg-gray-50">
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="{{ url_for('home') }}" class="text-gray-500 hover:text-gray-700">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                        </svg>
                    </a>
                    <span class="ml-4 text-xl font-bold text-gray-800">AI 聊天助手</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-4xl mx-auto px-4 py-4">
        <div class="messages-container" id="chat-messages">
            <!-- 歡迎訊息 -->
            <div class="flex mb-4">
                <div class="message assistant-message p-4">
                    您好！我是 AI 助手，很高興為您服務。請問有什麼我可以幫助您的嗎？
                </div>
            </div>
        </div>

        <div class="fixed bottom-0 left-0 right-0 bg-white border-t">
            <div class="max-w-4xl mx-auto px-4 py-4">
                <div class="flex gap-4">
                    <input type="text" 
                           id="message-input"
                           class="flex-1 rounded-lg border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="輸入訊息..."
                           onkeypress="if(event.key === 'Enter') document.getElementById('send-button').click()">
                    <button id="send-button"
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                        發送
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const messageContainer = document.getElementById('chat-messages');
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');

            function addMessage(message, isUser = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex mb-4 ' + (isUser ? 'justify-end' : '');
                
                const messageContent = document.createElement('div');
                messageContent.className = `message ${isUser ? 'user-message' : 'assistant-message'} p-4`;
                messageContent.textContent = message;
                
                messageDiv.appendChild(messageContent);
                messageContainer.appendChild(messageDiv);
                messageContainer.scrollTop = messageContainer.scrollHeight;
            }

            async function sendMessage() {
                const message = messageInput.value.trim();
                if (!message) return;

                // 添加用戶訊息
                addMessage(message, true);
                messageInput.value = '';

                try {
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message })
                    });

                    const data = await response.json();
                    // 添加 AI 回應
                    addMessage(data.response);
                } catch (error) {
                    console.error('Error:', error);
                    addMessage('抱歉，發生錯誤，請稍後再試。');
                }
            }

            sendButton.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        });
    </script>
</body>
</html>