<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Platform</title>
    <script src="/static/js/react.development.js"></script>
    <script src="/static/js/react-dom.development.js"></script>
    <script src="/static/js/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
    {% raw %}
        // 保持原有的 App 組件結構
        function App() {
            const [currentPage, setCurrentPage] = React.useState('Home');

            return (
                <div style={{ display: 'flex' }}>
                    {/* 保持原有的側邊欄 */}
                    <div style={{
                        width: '200px',
                        height: '100vh',
                        backgroundColor: '#f0f0f0',
                        padding: '20px'
                    }}>
                        <div 
                            onClick={() => setCurrentPage('Home')}
                            style={{
                                cursor: 'pointer',
                                padding: '10px',
                                backgroundColor: currentPage === 'Home' ? '#ddd' : 'transparent'
                            }}
                        >
                            Home
                        </div>
                        <div 
                            onClick={() => setCurrentPage('Models')}
                            style={{
                                cursor: 'pointer',
                                padding: '10px',
                                backgroundColor: currentPage === 'Models' ? '#ddd' : 'transparent'
                            }}
                        >
                            Models
                        </div>
                        <div 
                            onClick={() => setCurrentPage('ChatHistory')}
                            style={{
                                cursor: 'pointer',
                                padding: '10px',
                                backgroundColor: currentPage === 'ChatHistory' ? '#ddd' : 'transparent'
                            }}
                        >
                            Chat History
                        </div>
                        <div 
                            onClick={() => setCurrentPage('Agent')}
                            style={{
                                cursor: 'pointer',
                                padding: '10px',
                                backgroundColor: currentPage === 'Agent' ? '#ddd' : 'transparent'
                            }}
                        >
                            Agent
                        </div>
                    </div>

                    {/* 右側內容區域 */}
                    <div style={{ flex: 1, padding: '20px' }}>
                        {currentPage === 'Home' && <ChatUI />}
                        {currentPage === 'Models' && <div>Models Content</div>}
                        {currentPage === 'ChatHistory' && <div>Chat History Content</div>}
                        {currentPage === 'Agent' && <div>Agent Content</div>}
                    </div>
                </div>
            );
        }

        // 新增的聊天界面組件
        function ChatUI() {
            const [messages, setMessages] = React.useState([]);
            const [inputValue, setInputValue] = React.useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!inputValue.trim()) return;

                // 添加用戶消息
                const userMessage = { role: 'user', content: inputValue };
                setMessages([...messages, userMessage]);

                try {
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message: inputValue })
                    });

                    const data = await response.json();
                    
                    // 添加 AI 回覆
                    setMessages(msgs => [...msgs, { role: 'assistant', content: data.response }]);
                } catch (error) {
                    console.error('Error:', error);
                }

                setInputValue('');
            };

            return (
                <div style={{ height: '100vh', display: 'flex', flexDirection: 'column' }}>
                    <div style={{ flex: 1, overflowY: 'auto', padding: '20px' }}>
                        {messages.map((message, index) => (
                            <div 
                                key={index}
                                style={{
                                    marginBottom: '10px',
                                    padding: '10px',
                                    backgroundColor: message.role === 'user' ? '#e3f2fd' : '#f5f5f5',
                                    borderRadius: '5px',
                                    marginLeft: message.role === 'user' ? 'auto' : '0',
                                    marginRight: message.role === 'assistant' ? 'auto' : '0',
                                    maxWidth: '70%'
                                }}
                            >
                                {message.content}
                            </div>
                        ))}
                    </div>
                    <form onSubmit={handleSubmit} style={{ padding: '20px', borderTop: '1px solid #ddd' }}>
                        <input
                            type="text"
                            value={inputValue}
                            onChange={(e) => setInputValue(e.target.value)}
                            style={{
                                width: '100%',
                                padding: '10px',
                                borderRadius: '5px',
                                border: '1px solid #ddd'
                            }}
                            placeholder="Type your message here..."
                        />
                    </form>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
        {% endraw %}
    </script>
</body>
</html>
