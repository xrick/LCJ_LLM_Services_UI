<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Platform</title>
    <script src="/static/js/react.development.js"></script>
    <script src="/static/js/react-dom.development.js"></script>
    <script src="/static/js/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
    {% raw %}
        function App() {
            const [currentPage, setCurrentPage] = React.useState('Home');
            const [currentAgentSubpage, setCurrentAgentSubpage] = React.useState('');

            const renderContent = () => {
                switch (currentPage) {
                    case 'Home':
                        return <ChatUI />;
                    case 'Models':
                        return <div>Models Content</div>;
                    case 'ChatHistory':
                        return <div>Chat History Content</div>;
                    case 'Agent':
                        switch (currentAgentSubpage) {
                            case '寫作建議':
                                return <div>寫作建議 Content</div>;
                            case '法律條文':
                                return <div>法律條文 Content</div>;
                            case 'OCR服務':
                                return <div>OCR服務 Content</div>;
                            default:
                                return <div>請選擇 Agent 子項目</div>;
                        }
                    default:
                        return <div>選擇一個頁面</div>;
                }
            };

            return (
                <div style={{ display: 'flex' }}>
                    {/* 主側邊欄 */}
                    <div style={{
                        width: '200px',
                        height: '100vh',
                        backgroundColor: '#f0f0f0',
                        padding: '20px'
                    }}>
                        {['Home', 'Models', 'ChatHistory', 'Agent'].map(page => (
                            <div 
                                key={page}
                                onClick={() => {
                                    setCurrentPage(page);
                                    if (page !== 'Agent') setCurrentAgentSubpage('');
                                }}
                                style={{
                                    cursor: 'pointer',
                                    padding: '10px',
                                    backgroundColor: currentPage === page ? '#ddd' : 'transparent'
                                }}
                            >
                                {page}
                            </div>
                        ))}
                    </div>

                    {/* Agent 二級側邊欄 */}
                    {currentPage === 'Agent' && (
                        <div style={{
                            width: '150px',
                            height: '100vh',
                            backgroundColor: '#e0e0e0',
                            padding: '20px'
                        }}>
                            {['寫作建議', '法律條文', 'OCR服務'].map(subpage => (
                                <div 
                                    key={subpage}
                                    onClick={() => setCurrentAgentSubpage(subpage)}
                                    style={{
                                        cursor: 'pointer',
                                        padding: '10px',
                                        backgroundColor: currentAgentSubpage === subpage ? '#ccc' : 'transparent'
                                    }}
                                >
                                    {subpage}
                                </div>
                            ))}
                        </div>
                    )}

                    {/* 內容區域 */}
                    <div style={{ flex: 1, padding: '20px' }}>
                        {renderContent()}
                    </div>
                </div>
            );
        }

        // ChatUI 組件保持不變
        function ChatUI() {
            const [messages, setMessages] = React.useState([]);
            const [inputValue, setInputValue] = React.useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!inputValue.trim()) return;

                const userMessage = { role: 'user', content: inputValue };
                setMessages([...messages, userMessage]);

                try {
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message: inputValue })
                    });

                    const data = await response.json();
                    
                    setMessages(msgs => [...msgs, { role: 'assistant', content: data.response }]);
                } catch (error) {
                    console.error('Error:', error);
                }

                setInputValue('');
            };

            return (
                <div style={{ height: '100vh', display: 'flex', flexDirection: 'column' }}>
                    <div style={{ flex: 1, overflowY: 'auto', padding: '20px' }}>
                        {messages.map((message, index) => (
                            <div 
                                key={index}
                                style={{
                                    marginBottom: '10px',
                                    padding: '10px',
                                    backgroundColor: message.role === 'user' ? '#e3f2fd' : '#f5f5f5',
                                    borderRadius: '5px',
                                    marginLeft: message.role === 'user' ? 'auto' : '0',
                                    marginRight: message.role === 'assistant' ? 'auto' : '0',
                                    maxWidth: '70%'
                                }}
                            >
                                {message.content}
                            </div>
                        ))}
                    </div>
                    <form onSubmit={handleSubmit} style={{ padding: '20px', borderTop: '1px solid #ddd' }}>
                        <input
                            type="text"
                            value={inputValue}
                            onChange={(e) => setInputValue(e.target.value)}
                            style={{
                                width: '100%',
                                padding: '10px',
                                borderRadius: '5px',
                                border: '1px solid #ddd'
                            }}
                            placeholder="Type your message here..."
                        />
                    </form>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    {% endraw %}
    </script>
</body>
</html>